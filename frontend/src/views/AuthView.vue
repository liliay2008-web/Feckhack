<template>
  <div class="min-h-screen flex items-center justify-start p-4 relative overflow-hidden">
    <!-- –ö—Ä–∞—Å–∏–≤—ã–π –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
      <!-- –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω -->
      <div class="absolute inset-0 bg-gradient-to-br from-purple-600 via-indigo-600 via-pink-500 to-cyan-500 opacity-90"></div>
      
      <!-- –ü–ª–∞–≤–∞—é—â–∏–µ blob —ç–ª–µ–º–µ–Ω—Ç—ã -->
      <div class="absolute -top-40 -right-40 w-96 h-96 bg-purple-400 rounded-full mix-blend-multiply filter blur-3xl opacity-40 animate-blob"></div>
      <div class="absolute -bottom-40 -left-40 w-96 h-96 bg-pink-400 rounded-full mix-blend-multiply filter blur-3xl opacity-40 animate-blob animation-delay-2000"></div>
      <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-indigo-400 rounded-full mix-blend-multiply filter blur-3xl opacity-40 animate-blob animation-delay-4000"></div>
      <div class="absolute top-20 right-1/4 w-72 h-72 bg-cyan-400 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-6000"></div>
      <div class="absolute bottom-20 left-1/4 w-72 h-72 bg-blue-400 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-8000"></div>
      
      <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ—Ç–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã -->
      <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-purple-500/20 via-transparent to-pink-500/20"></div>
      <div class="absolute top-0 right-0 w-1/2 h-full bg-gradient-to-l from-indigo-500/20 to-transparent"></div>
      
      <!-- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ñ–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å) -->
      <div 
        v-if="backgroundStyle.backgroundImage"
        class="absolute inset-0 opacity-20"
        :style="{
          backgroundImage: backgroundStyle.backgroundImage,
          backgroundSize: 'cover',
          backgroundPosition: 'center',
          backgroundRepeat: 'no-repeat',
          mixBlendMode: 'overlay'
        }"
      ></div>
    </div>
    <div class="w-full max-w-md relative z-10 ml-8 lg:ml-16" style="z-index: 10;">
      <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–æ —Å—Ç–µ–∫–ª—è–Ω–Ω—ã–º —ç—Ñ—Ñ–µ–∫—Ç–æ–º -->
      <div class="rounded-3xl p-8 lg:p-10 shadow-2xl animate-fade-in w-full relative overflow-hidden" style="
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px) saturate(180%);
        -webkit-backdrop-filter: blur(20px) saturate(180%);
        border: 2px solid rgba(255, 255, 255, 0.8);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3), inset 0 1px 1px rgba(255, 255, 255, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.3);
        box-sizing: border-box;
        z-index: 100;
      ">
        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–ª–æ–π –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ —Å—Ç–µ–∫–ª–∞ -->
        <div class="absolute inset-0 bg-gradient-to-br from-white/2 via-white/1 to-transparent pointer-events-none" style="border-radius: 1.5rem;"></div>
        <!-- –†–µ—Ñ–ª–µ–∫—Å –Ω–∞ —Å—Ç–µ–∫–ª–µ -->
        <div class="absolute top-0 left-0 right-0 h-1/3 bg-gradient-to-b from-white/5 to-transparent pointer-events-none rounded-t-3xl"></div>
        
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Ñ–æ—Ä–º—ã -->
        <div class="relative z-10">
          <h1 class="text-3xl font-bold mb-8 text-center" style="color: #1a1a1a; font-family: sans-serif; text-shadow: 0 2px 4px rgba(255, 255, 255, 0.8), 0 1px 2px rgba(0, 0, 0, 0.2);">
            {{ isLogin ? '–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É' : '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è' }}
          </h1>
          
          <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–æ–ª–µ–π -->
          <div class="mb-8 p-1 rounded-lg relative overflow-hidden" style="
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 2px solid rgba(139, 92, 246, 0.3);
            box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.5), 0 2px 8px rgba(139, 92, 246, 0.1);
          ">
          <div class="relative flex">
            <!-- –°–∫–æ–ª—å–∑—è—â–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä -->
            <div 
              class="absolute top-1 bottom-1 rounded-lg transition-all duration-300 ease-in-out"
              :style="{
                left: currentRole === 'admin' ? '4px' : 'calc(50% + 2px)',
                width: 'calc(50% - 6px)',
                background: 'linear-gradient(135deg, #5C2D91 0%, #7B2FA2 100%)',
                boxShadow: '0 4px 15px rgba(92, 45, 145, 0.4)',
                zIndex: 0
              }"
            ></div>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä -->
            <button
              @click="currentRole = 'admin'"
              type="button"
              class="relative flex-1 py-3 px-4 rounded-lg font-semibold transition-colors duration-300 z-10"
              :style="{
                color: currentRole === 'admin' ? '#FFFFFF' : '#1a1a1a',
                backgroundColor: 'transparent',
                fontFamily: 'sans-serif',
                border: 'none',
                outline: 'none',
                cursor: 'pointer',
                textShadow: currentRole === 'admin' ? '0 2px 4px rgba(0, 0, 0, 0.3)' : '0 2px 4px rgba(255, 255, 255, 0.5), 0 1px 2px rgba(0, 0, 0, 0.1)'
              }"
            >
              –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
            </button>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –°—Ç–∞—Ä–æ—Å—Ç–∞ -->
            <button
              @click="currentRole = 'starosta'"
              type="button"
              class="relative flex-1 py-3 px-4 rounded-lg font-semibold transition-colors duration-300 z-10"
              :style="{
                color: currentRole === 'starosta' ? '#FFFFFF' : '#1a1a1a',
                backgroundColor: 'transparent',
                fontFamily: 'sans-serif',
                border: 'none',
                outline: 'none',
                cursor: 'pointer',
                textShadow: currentRole === 'starosta' ? '0 2px 4px rgba(0, 0, 0, 0.3)' : '0 2px 4px rgba(255, 255, 255, 0.5), 0 1px 2px rgba(0, 0, 0, 0.1)'
              }"
            >
              –°—Ç–∞—Ä–æ—Å—Ç–∞
            </button>
          </div>
        </div>

          <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
          <form @submit.prevent="handleSubmit" class="space-y-5" v-if="!isLogin">
            <div class="flex items-center gap-4">
              <label for="full_name" class="font-medium flex-shrink-0 text-left" style="color: #1a1a1a; min-width: 120px; font-family: sans-serif; text-shadow: 0 2px 4px rgba(255, 255, 255, 0.5), 0 1px 2px rgba(0, 0, 0, 0.1);">–§–ò–û:</label>
              <input
                id="full_name"
                v-model="formData.full_name"
                type="text"
                required
                class="flex-1 px-4 py-2.5 rounded-lg border focus:outline-none focus:ring-2 focus:ring-purple-500 min-w-0"
                style="
                  background: rgba(255, 255, 255, 0.9);
                  backdrop-filter: blur(10px);
                  -webkit-backdrop-filter: blur(10px);
                  border: 2px solid rgba(139, 92, 246, 0.3);
                  font-family: sans-serif;
                  box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.5), 0 2px 8px rgba(139, 92, 246, 0.1);
                  color: #1a1a1a;
                "
                placeholder="–í–≤–µ–¥–∏—Ç–µ –§–ò–û"
              />
            </div>

            <div class="flex items-center gap-4">
              <label for="email" class="font-medium flex-shrink-0 text-left" style="color: #1a1a1a; min-width: 120px; font-family: sans-serif; text-shadow: 0 2px 4px rgba(255, 255, 255, 0.5), 0 1px 2px rgba(0, 0, 0, 0.1);">Email:</label>
              <input
                id="email"
                v-model="formData.email"
                type="email"
                required
                class="flex-1 px-4 py-2.5 rounded-lg border focus:outline-none focus:ring-2 focus:ring-purple-500 min-w-0"
                style="
                  background: rgba(255, 255, 255, 0.9);
                  backdrop-filter: blur(10px);
                  -webkit-backdrop-filter: blur(10px);
                  border: 2px solid rgba(139, 92, 246, 0.3);
                  font-family: sans-serif;
                  box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.5), 0 2px 8px rgba(139, 92, 246, 0.1);
                  color: #1a1a1a;
                "
                placeholder="–í–≤–µ–¥–∏—Ç–µ email"
              />
            </div>

            <div class="flex items-center gap-4">
              <label for="login" class="font-medium flex-shrink-0 text-left" style="color: #1a1a1a; min-width: 120px; font-family: sans-serif; text-shadow: 0 2px 4px rgba(255, 255, 255, 0.5), 0 1px 2px rgba(0, 0, 0, 0.1);">–õ–æ–≥–∏–Ω:</label>
              <input
                id="login"
                v-model="formData.login"
                type="text"
                required
                class="flex-1 px-4 py-2.5 rounded-lg border focus:outline-none focus:ring-2 focus:ring-purple-500 min-w-0"
                style="
                  background: rgba(255, 255, 255, 0.9);
                  backdrop-filter: blur(10px);
                  -webkit-backdrop-filter: blur(10px);
                  border: 2px solid rgba(139, 92, 246, 0.3);
                  font-family: sans-serif;
                  box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.5), 0 2px 8px rgba(139, 92, 246, 0.1);
                  color: #1a1a1a;
                "
                placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω"
              />
            </div>

            <div class="flex items-center gap-4">
              <label for="password" class="font-medium flex-shrink-0 text-left" style="color: #1a1a1a; min-width: 120px; font-family: sans-serif; text-shadow: 0 2px 4px rgba(255, 255, 255, 0.5), 0 1px 2px rgba(0, 0, 0, 0.1);">–ü–∞—Ä–æ–ª—å:</label>
              <input
                id="password"
                v-model="formData.password"
                type="password"
                required
                class="flex-1 px-4 py-2.5 rounded-lg border focus:outline-none focus:ring-2 focus:ring-purple-500 min-w-0"
                style="
                  background: rgba(255, 255, 255, 0.9);
                  backdrop-filter: blur(10px);
                  -webkit-backdrop-filter: blur(10px);
                  border: 2px solid rgba(139, 92, 246, 0.3);
                  font-family: sans-serif;
                  box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.5), 0 2px 8px rgba(139, 92, 246, 0.1);
                  color: #1a1a1a;
                "
                placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
              />
            </div>

            <div v-if="currentRole === 'starosta'" class="flex items-center gap-4">
              <label for="groups" class="font-medium flex-shrink-0 text-left" style="color: #1a1a1a; min-width: 120px; font-family: sans-serif; text-shadow: 0 2px 4px rgba(255, 255, 255, 0.5), 0 1px 2px rgba(0, 0, 0, 0.1);">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É:</label>
              <div class="flex-1 min-w-0 overflow-hidden">
                <el-select
                  id="groups"
                  v-model="formData.groups"
                  placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É"
                  style="width: 100%;"
                >
                  <el-option
                    v-for="group in availableGroups"
                    :key="group"
                    :label="group"
                    :value="group"
                  />
                </el-select>
              </div>
            </div>

            <button
              type="button"
              @click.prevent="handleSubmit"
              class="w-full py-3.5 text-lg font-bold text-white rounded-lg transition-all duration-300 hover:opacity-90 mt-6"
              style="
                background: linear-gradient(135deg, #5C2D91 0%, #7B2FA2 100%);
                box-shadow: 0 4px 15px rgba(92, 45, 145, 0.4);
                font-family: sans-serif;
                letter-spacing: 0.5px;
              "
              :disabled="loading"
            >
              {{ loading ? '–ó–∞–≥—Ä—É–∑–∫–∞...' : '–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø' }}
            </button>
          </form>

          <!-- –§–æ—Ä–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
          <form @submit.prevent="handleLogin" class="space-y-5" v-else>
            <div class="flex items-center gap-4">
              <label for="login_email" class="font-medium flex-shrink-0 text-left" style="color: #1a1a1a; min-width: 140px; font-family: sans-serif; text-shadow: 0 2px 4px rgba(255, 255, 255, 0.5), 0 1px 2px rgba(0, 0, 0, 0.1);">–õ–æ–≥–∏–Ω –∏–ª–∏ Email:</label>
              <input
                id="login_email"
                v-model="loginData.login"
                type="text"
                required
                class="flex-1 px-4 py-2.5 rounded-lg border focus:outline-none focus:ring-2 focus:ring-purple-500 min-w-0"
                style="
                  background: rgba(255, 255, 255, 0.9);
                  backdrop-filter: blur(10px);
                  -webkit-backdrop-filter: blur(10px);
                  border: 2px solid rgba(139, 92, 246, 0.3);
                  font-family: sans-serif;
                  box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.5), 0 2px 8px rgba(139, 92, 246, 0.1);
                  color: #1a1a1a;
                "
                placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏–ª–∏ email"
              />
            </div>

            <div class="flex items-center gap-4">
              <label for="login_password" class="font-medium flex-shrink-0 text-left" style="color: #1a1a1a; min-width: 140px; font-family: sans-serif; text-shadow: 0 2px 4px rgba(255, 255, 255, 0.5), 0 1px 2px rgba(0, 0, 0, 0.1);">–ü–∞—Ä–æ–ª—å:</label>
              <input
                id="login_password"
                v-model="loginData.password"
                type="password"
                required
                class="flex-1 px-4 py-2.5 rounded-lg border focus:outline-none focus:ring-2 focus:ring-purple-500 min-w-0"
                style="
                  background: rgba(255, 255, 255, 0.9);
                  backdrop-filter: blur(10px);
                  -webkit-backdrop-filter: blur(10px);
                  border: 2px solid rgba(139, 92, 246, 0.3);
                  font-family: sans-serif;
                  box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.5), 0 2px 8px rgba(139, 92, 246, 0.1);
                  color: #1a1a1a;
                "
                placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
              />
            </div>

            <button
              type="submit"
              class="w-full py-3.5 text-lg font-bold text-white rounded-lg transition-all duration-300 hover:opacity-90 mt-6"
              style="
                background: linear-gradient(135deg, #5C2D91 0%, #7B2FA2 100%);
                box-shadow: 0 4px 15px rgba(92, 45, 145, 0.4);
                font-family: sans-serif;
                letter-spacing: 0.5px;
              "
              :disabled="loading"
            >
              {{ loading ? '–ó–∞–≥—Ä—É–∑–∫–∞...' : '–í–û–ô–¢–ò' }}
            </button>
          </form>

          <!-- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π -->
          <div class="mt-6 text-center">
            <button
              @click="isLogin = !isLogin"
              type="button"
              class="transition-colors duration-300"
              style="font-family: sans-serif;"
            >
              <span v-if="!isLogin" style="color: #1a1a1a; font-weight: 600; text-shadow: 0 2px 4px rgba(255, 255, 255, 0.8), 0 1px 2px rgba(0, 0, 0, 0.2);">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? </span>
              <span v-else style="color: #1a1a1a; font-weight: 600; text-shadow: 0 2px 4px rgba(255, 255, 255, 0.8), 0 1px 2px rgba(0, 0, 0, 0.2);">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? </span>
              <span class="underline font-semibold" style="color: #9C27B0;">
                {{ isLogin ? '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è' : '–í–æ–π—Ç–∏' }}
              </span>
            </button>
          </div>

          <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ -->
          <div v-if="error" class="mt-4 p-4 bg-red-100/90 border-2 border-red-500 text-red-800 rounded-lg backdrop-blur-sm shadow-lg" style="font-family: sans-serif;">
            <div class="flex items-start">
              <span class="text-red-600 mr-2 text-xl">‚ö†Ô∏è</span>
              <div class="flex-1">
                <p class="font-semibold mb-1">–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</p>
                <p class="text-sm">{{ error }}</p>
              </div>
              <button 
                @click="error = ''" 
                class="text-red-600 hover:text-red-800 ml-2"
                type="button"
              >
                ‚úï
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive, watch, computed } from 'vue';
import { useRouter } from 'vue-router';
import { useAuthStore } from '../stores/auth';
import api from '../api/axios';

const router = useRouter();
const authStore = useAuthStore();

// –°—Ç–∏–ª—å —Ñ–æ–Ω–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
const backgroundStyle = computed(() => {
  // –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
  // return {
  //   backgroundImage: 'url(/images/back.png)',
  // };
  return {};
});

const isLogin = ref(false);
const currentRole = ref('admin');
const loading = ref(false);
const error = ref('');

const formData = reactive({
  full_name: '',
  email: '',
  login: '',
  password: '',
  role: 'admin',
  groups: null
});

const loginData = reactive({
  login: '',
  password: ''
});

const availableGroups = ref([
  '–ò–°-101', '–ò–°-102', '–ò–°-103', '–ò–°-104', '–ò–°-105', '–ò–°-106', '–ò–°-107', '–ò–°-111', '–ò–°-112',
  '–ò–°-201', '–ò–°-202', '–ò–°-203', '–ò–°-204', '–ò–°-205', '–ò–°-211', '–ò–°-212',
  '–ò–°-301', '–ò–°-302', '–ò–°-303', '–ò–°-304', '–ò–°-305', '–ò–°-311', '–ò–°-312',
  '–ò–°-401', '–ò–°-402', '–ò–°-403',
  '–ë-101', '–ë-102', '–ë-111',
  '–ë-201', '–ë-202', '–ë-203', '–ë-211',
  '–ë-301',
  '–ë–î-101', '–ë–î-102', '–ë–î-111',
  '–ë–î-201', '–ë–î-202', '–ë–î-203', '–ë–î-211',
  '–ë–î-301', '–ë–î-302',
  '–¢–û–†-101', '–¢–û–†-102', '–¢–û–†-103', '–¢–û–†-111',
  '–¢–û–†-201', '–¢–û–†-202', '–¢–û–†-203', '–¢–û–†-211',
  '–ö-301', '–ö-302', '–ö-303',
  '–§-101', '–§-102', '–§-103', '–§-104', '–§-105', '–§-106', '–§-111',
  '–§-201', '–§-202', '–§-203', '–§-204', '–§-211', '–§-212',
  '–§-301', '–§-302', '–§-303', '–§-304',
  '–Æ–†-101', '–Æ–†-102', '–Æ–†-103', '–Æ–†-104', '–Æ–†-105', '–Æ–†-106', '–Æ–†-107', '–Æ–†-108', '–Æ–†-109', '–Æ–†-111', '–Æ–†-112',
  '–Æ–†-201', '–Æ–†-202', '–Æ–†-203', '–Æ–†-204', '–Æ–†-205', '–Æ–†-206', '–Æ–†-207', '–Æ–†-208', '–Æ–†-211', '–Æ–†-212',
  '–ü-301', '–ü-302', '–ü-303', '–ü-304', '–ü-305', '–ü-306', '–ü-307'
]);

watch(currentRole, (newRole) => {
  formData.role = newRole;
  // –û—á–∏—â–∞–µ–º –≥—Ä—É–ø–ø—ã –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–æ–ª–∏
  formData.groups = null;
});

const handleSubmit = async (event) => {
  // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã
  if (event) {
    event.preventDefault();
    event.stopPropagation();
  }
  
  loading.value = true;
  error.value = '';

  try {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
    if (!formData.full_name || !formData.email || !formData.login || !formData.password) {
      error.value = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è';
      loading.value = false;
      return;
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è email (–±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∞—è)
    const trimmedEmail = formData.email.trim();
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!trimmedEmail || !emailRegex.test(trimmedEmail)) {
      error.value = `–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä: example@gmail.com). –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: "${trimmedEmail}"`;
      loading.value = false;
      return;
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã –ø–∞—Ä–æ–ª—è
    if (formData.password.length < 6) {
      error.value = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤';
      loading.value = false;
      return;
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –ª–æ–≥–∏–Ω–∞
    if (formData.login.trim().length < 3) {
      error.value = '–õ–æ–≥–∏–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞';
      loading.value = false;
      return;
    }

    // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
    const dataToSend = {
      full_name: formData.full_name.trim(),
      email: formData.email.trim(),
      login: formData.login.trim(),
      password: formData.password,
      role: currentRole.value
    };

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä—É–ø–ø –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
    if (currentRole.value === 'starosta') {
      // –î–ª—è —Å—Ç–∞—Ä–æ—Å—Ç—ã - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–¥–Ω–∞ –≥—Ä—É–ø–ø–∞
      if (!formData.groups) {
        error.value = '–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É –¥–ª—è —Å—Ç–∞—Ä–æ—Å—Ç—ã';
        loading.value = false;
        return;
      }
      // –î–ª—è —Å—Ç–∞—Ä–æ—Å—Ç—ã - –æ–¥–Ω–∞ –≥—Ä—É–ø–ø–∞ –≤ –º–∞—Å—Å–∏–≤–µ
      dataToSend.groups = [formData.groups];
    } else {
      // –î–ª—è –∞–¥–º–∏–Ω–∞ –≥—Ä—É–ø–ø—ã –Ω–µ –Ω—É–∂–Ω—ã - —è–≤–Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
      dataToSend.groups = null;
    }

    console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', { ...dataToSend, password: '***' });

    try {
      console.log('–ù–∞—á–∞–ª–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –¥–∞–Ω–Ω—ã–µ:', { ...dataToSend, password: '***' });
      const result = await authStore.register(dataToSend);
      
      console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', {
        success: result.success,
        hasData: !!result.data,
        hasError: !!result.error,
        user: result.data?.user,
        role: result.data?.user?.role
      });

      if (result.success) {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–æ–ª—å –∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞
        const userRole = result.data?.user?.role || currentRole.value;
        
        console.log('‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞, —Ä–æ–ª—å:', userRole);
        console.log('‚úÖ –¢–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', !!authStore.token);
        console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', !!authStore.user);
        
        // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Ç–æ–∫–µ–Ω –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
        if (!authStore.token || !authStore.user) {
          console.error('‚ùå –¢–æ–∫–µ–Ω –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!');
          error.value = '–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –±—ã–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏.';
          loading.value = false;
          return;
        }
        
        // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        formData.full_name = '';
        formData.email = '';
        formData.login = '';
        formData.password = '';
        formData.groups = null;
        error.value = '';
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º loading –ø–µ—Ä–µ–¥ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º
        loading.value = false;
        
        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏, —á—Ç–æ store –æ–±–Ω–æ–≤–ª–µ–Ω
        await new Promise(resolve => setTimeout(resolve, 50));
        
        // –†–µ–¥–∏—Ä–µ–∫—Ç —á–µ—Ä–µ–∑ router
        try {
          if (userRole === 'admin') {
            console.log('üîÑ –†–µ–¥–∏—Ä–µ–∫—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–∞ /admin');
            await router.push('/admin');
          } else if (userRole === 'starosta') {
            console.log('üîÑ –†–µ–¥–∏—Ä–µ–∫—Ç —Å—Ç–∞—Ä–æ—Å—Ç—ã –Ω–∞ /starosta/topics');
            await router.push('/starosta/topics');
          } else {
            console.error('‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ä–æ–ª—å:', userRole);
            error.value = '–û—à–∏–±–∫–∞: –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
          }
        } catch (routerError) {
          console.error('–û—à–∏–±–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞:', routerError);
          // –ï—Å–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ window.location
          if (userRole === 'admin') {
            window.location.href = '/admin';
          } else if (userRole === 'starosta') {
            window.location.href = '/starosta/topics';
          }
        }
      } else {
        // –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–∫–∏
        const errorMsg = result.error || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.';
        error.value = errorMsg;
        loading.value = false;
        console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–¥–µ—Ç–∞–ª–∏):', {
          error: result.error,
          fullError: result,
          data: dataToSend,
          role: currentRole.value
        });
      }
    } catch (storeError) {
      // –ï—Å–ª–∏ store –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É, –Ω–æ –Ω–µ –≤—ã–±—Ä–æ—Å–∏–ª –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
      console.error('–û—à–∏–±–∫–∞ –≤ store:', storeError);
      error.value = storeError?.error || storeError?.message || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.';
      loading.value = false;
    }
  } catch (err) {
    console.error('–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', err);
    // –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
    let errorMessage = '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.';
    
    if (err.response) {
      // –û—à–∏–±–∫–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
      errorMessage = err.response.data?.error || err.response.data?.message || errorMessage;
      if (err.response.data?.details) {
        console.error('–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:', err.response.data.details);
      }
    } else if (err.request) {
      // –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω, –Ω–æ –æ—Ç–≤–µ—Ç–∞ –Ω–µ—Ç
      errorMessage = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.';
    } else {
      // –û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∑–∞–ø—Ä–æ—Å–∞
      errorMessage = err.message || errorMessage;
    }
    
    error.value = errorMessage;
    loading.value = false;
  }
};

const handleLogin = async () => {
  loading.value = true;
  error.value = '';

  try {
    const result = await authStore.login(loginData.login, loginData.password);

    if (result.success) {
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º loading –ø–µ—Ä–µ–¥ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º
      loading.value = false;
      
      // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏, —á—Ç–æ store –æ–±–Ω–æ–≤–ª–µ–Ω
      await new Promise(resolve => setTimeout(resolve, 50));
      
      // –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ router
      const userRole = result.data.user.role;
      try {
        if (userRole === 'admin') {
          await router.push('/admin');
        } else if (userRole === 'starosta') {
          await router.push('/starosta/topics');
        }
      } catch (routerError) {
        console.error('–û—à–∏–±–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞:', routerError);
        // –ï—Å–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ window.location
        if (userRole === 'admin') {
          window.location.href = '/admin';
        } else if (userRole === 'starosta') {
          window.location.href = '/starosta/topics';
        }
      }
    } else {
      error.value = result.error;
      loading.value = false;
    }
  } catch (err) {
    error.value = '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏';
    loading.value = false;
  }
};

// –ì—Ä—É–ø–ø—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ

// –ì—Ä—É–ø–ø—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ, –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ–º
</script>

<style scoped>
.animate-fade-in {
  animation: fadeIn 0.6s ease-out;
}

@keyframes blob {
  0%, 100% {
    transform: translate(0, 0) scale(1) rotate(0deg);
  }
  25% {
    transform: translate(50px, -80px) scale(1.15) rotate(90deg);
  }
  50% {
    transform: translate(-40px, 40px) scale(0.95) rotate(180deg);
  }
  75% {
    transform: translate(30px, 60px) scale(1.05) rotate(270deg);
  }
}

.animate-blob {
  animation: blob 8s infinite ease-in-out;
}

.animation-delay-2000 {
  animation-delay: 2s;
}

.animation-delay-4000 {
  animation-delay: 4s;
}

.animation-delay-6000 {
  animation-delay: 6s;
}

.animation-delay-8000 {
  animation-delay: 8s;
}

.background-container {
  position: relative;
  min-height: 100vh;
  image-rendering: -webkit-optimize-contrast;
  image-rendering: crisp-edges;
  image-rendering: high-quality;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
@media (max-width: 768px) {
  .background-container {
    background-attachment: scroll !important;
  }
}
</style>
